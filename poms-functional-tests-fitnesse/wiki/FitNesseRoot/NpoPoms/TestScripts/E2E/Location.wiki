---
Help: Aanmaken, wijzigen en verwijderen van een bron (location) in de backend zijn zichtbaar in de gui.
Suites: NPOAPI-155, RG
Test
---
!*> Test-specific items
!define gebruiker {standaard-gebruiker}

!define bodyClip { {{{
<program avType="AUDIO" embeddable="true" type="CLIP" xmlns="urn:vpro:media:update:2009">
  <broadcaster>NPO</broadcaster>
  <title type="MAIN">Speciaal Clip</title>
  <genre>3.0.1.7.21</genre>
  <credits/>
  <locations/>
  <scheduleEvents/>
  <images/>
  <segments/>
</program>
}}} }

!define programUrl {!-http://a.omroep.nl/19.mp3-!}
!define publishStartApi {2012-01-11T16:16:01.287+01:00}
!define publishStartGui {11-01-2012 16:16}

!define avFileFormat1 {MP3}
!define bitrate1 {128000}
!define duration1 {P0DT0H10M2.000S}

!define bodyLocation1 { {{{
<?xml version="1.0" encoding="utf-8"?>
<location xmlns="urn:vpro:media:update:2009" publishStart="${publishStartApi}">
  <programUrl>${programUrl}</programUrl>
  <avAttributes>
    <bitrate>${bitrate1}</bitrate>
    <avFileFormat>${avFileFormat1}</avFileFormat>
    <videoAttributes/>
  </avAttributes>
  <duration>${duration1}</duration>
</location>
}}} }

!define publishStopApi2 {2012-01-11T18:16:01.287+01:00}
!define publishStopGui2 {11-01-2012 18:16}
!define avFileFormat2 {MP4}
!define bitrate2 {6000}
!define duration2 {P0DT0H30M4.000S}

!define bodyLocation2 { {{{
<?xml version="1.0" encoding="utf-8"?>
<location xmlns="urn:vpro:media:update:2009" publishStart="${publishStartApi}" publishStop="${publishStopApi2}">
  <programUrl>${programUrl}</programUrl>
  <avAttributes>
    <bitrate>${bitrate2}</bitrate>
    <avFileFormat>${avFileFormat2}</avFileFormat>
    <videoAttributes/>
  </avAttributes>
  <duration>${duration2}</duration>
</location>
}}} }
*!

!include -c <E2E.ApiBackendSetUp

!4 Save current number of locations (bronnen)

|script                                                                     |
|$mid=        |get var          |midClip                                    |
|get from     |${urlBackendApi}/media/media/$mid/locations?owner=BROADCASTER|
|$sourceCount=|xPath            |count(/collection/update:location)         |

!4 Add location (bron) to clip in backend

|script                                                                                |
|show |post           |${bodyLocation1}|to|${urlBackendApi}/media/program/$mid/location|
|check|response status|202                                                             |
|check|response       |Location accepted for $mid.                                     |

!4 Check location (bron) is added to clip in backend

|script                                                                                                                                                           |
|get from    |${urlBackendApi}/media/program/$mid/locations?owner=BROADCASTER                                                                                     |
|check       |xPath         |/update:collection/update:location[last()]/@publishStart                          |${publishStartApi}                                |
|check       |xPath         |/update:collection/update:location[last()]/update:programUrl                      |${programUrl}                                     |
|check       |xPath         |/update:collection/update:location[last()]/update:avAttributes/update:bitrate     |${bitrate1}                                       |
|check       |xPath         |/update:collection/update:location[last()]/update:avAttributes/update:avFileFormat|${avFileFormat1}                                  |
|check       |xPath         |/update:collection/update:location[last()]/update:duration                        |${duration1}                                      |
|$urn=       |xPath         |/update:collection/update:location/@urn                                                                                              |
|$locationId=|extract string|$urn                                                                              |from|^urn:vpro:media:location:(\d+)$|using group|1|

!include -c <E2E.GuiSetUp

!4 Check location (bron) is added to clip in gui

|script                                                                                                            |
|Open Npo poms website                                                                                             |
|Npo poms Inlogscherm Log in met ${gebruiker}                                                                      |
|Npo poms Zoeken Vul                                           |$mid              |in zoekveld                     |
|Npo poms Zoeken Druk knop                                     |Zoeken                                             |
|Npo poms Zoeken Wacht tot zoeken klaar is                                                                         |
|ensure                                                        |is visible on page|Gezocht naar: '$mid'            |
|Npo poms Zoeken Check aantal zoekresultaten                   |1                                                  |
|Npo poms Zoeken Open eerste object                                                                                |
|Npo poms Tabblad object Druk op link                          |Bronnen           |in sidebar                      |
|Npo poms Tabblad object Wacht tot scrollen klaar is                                                               |
|set search context to                                         |xpath=//poms-locations                             |
|Npo poms Tabblad object Check aantal in veld                  |Bronnen           |is           |1                 |
|Npo poms Tabblad object Check bron                            |${programUrl}     |zichtbaar                       |
|Npo poms Tabblad object Check bron                            |${programUrl}     |heeft formaat|${avFileFormat1}  |
|Npo poms Tabblad object Check bron                            |${programUrl}     |online sinds |${publishStartGui}|
|double click                                                  |${programUrl}                                      |
|clear search context                                                                                              |
|Npo poms Tabblad object Detailscherm Check tekstveld          |URL *             |heeft waarde |${programUrl}     |
|Npo poms Tabblad object Detailscherm Check bewerkbare dropdown|Type *            |heeft waarde |${avFileFormat1}  |
|Npo poms Tabblad object Detailscherm Check tekstveld          |Bitrate           |heeft waarde |${bitrate1}       |
|Npo poms Tabblad object Detailscherm Check bron online sinds  |${publishStartGui}                                 |
|Npo poms Tabblad object Detailscherm Druk op kruisje om pop-up te sluiten                                         |

!include -c <E2E.GuiTearDown
!include -c <E2E.ApiBackendSetUp

!4 Edit location (bron) in backend

|script                                                                                |
|show |post           |${bodyLocation2}|to|${urlBackendApi}/media/program/$mid/location|
|check|response status|202                                                             |
|check|response       |Location accepted for $mid.                                     |

!4 Check changes in source visible in backend

|script                                                                                                              |
|get from|${urlBackendApi}/media/program/$mid/locations?owner=BROADCASTER                                            |
|check   |xPath|/update:collection/update:location[last()]/@publishStart                          |${publishStartApi}|
|check   |xPath|/update:collection/update:location[last()]/@publishStop                           |${publishStopApi2}|
|check   |xPath|/update:collection/update:location[last()]/update:programUrl                      |${programUrl}     |
|check   |xPath|/update:collection/update:location[last()]/update:avAttributes/update:bitrate     |${bitrate2}       |
|check   |xPath|/update:collection/update:location[last()]/update:avAttributes/update:avFileFormat|${avFileFormat2}  |
|check   |xPath|/update:collection/update:location[last()]/update:duration                        |${duration2}      |

!include -c <E2E.GuiSetUp

!4 Check changes in source visible in gui

|script                                                                                                                                   |
|Open Npo poms website                                                                                                                    |
|Npo poms Inlogscherm Log in met ${gebruiker}                                                                                             |
|Npo poms Zoeken Vul                                           |$mid              |in zoekveld                                            |
|Npo poms Zoeken Druk knop                                     |Zoeken                                                                    |
|Npo poms Zoeken Wacht tot zoeken klaar is                                                                                                |
|ensure                                                        |is visible on page|Gezocht naar: '$mid'                                   |
|Npo poms Zoeken Check aantal zoekresultaten                   |1                                                                         |
|Npo poms Zoeken Open eerste object                                                                                                       |
|Npo poms Tabblad object Druk op link                          |Bronnen           |in sidebar                                             |
|Npo poms Tabblad object Wacht tot scrollen klaar is                                                                                      |
|Npo poms Tabblad object Check aantal in veld                  |Bronnen           |is           |1                                        |
|Npo poms Tabblad object Check bron                            |${programUrl}     |zichtbaar                                              |
|Npo poms Tabblad object Check bron                            |${programUrl}     |heeft formaat|${avFileFormat2}                         |
|Npo poms Tabblad object Check bron                            |${programUrl}     |online van   |${publishStartGui}|tot|${publishStopGui2}|
|double click                                                  |${programUrl}                                                             |
|clear search context                                                                                                                     |
|Npo poms Tabblad object Detailscherm Check tekstveld          |URL *             |heeft waarde |${programUrl}                            |
|Npo poms Tabblad object Detailscherm Check bewerkbare dropdown|Type *            |heeft waarde |${avFileFormat2}                         |
|Npo poms Tabblad object Detailscherm Check tekstveld          |Bitrate           |heeft waarde |${bitrate2}                              |
|Npo poms Tabblad object Detailscherm Check bron online van    |${publishStartGui}|tot          |${publishStopGui2}                       |
|Npo poms Tabblad object Detailscherm Druk op kruisje om pop-up te sluiten                                                                |

!include -c <E2E.GuiTearDown
!include -c <E2E.ApiBackendSetUp

!4 Remove location (bron) from clip

|script                                                                              |
|get from    |${urlBackendApi}/media/program/$mid/locations?owner=BROADCASTER        |
|$urn=       |xPath         |/collection/update:location/@urn                        |
|$locationId=|extract string|$urn |from|^urn:vpro:media:location:(\d+)$|using group|1|
|show        |delete        |${urlBackendApi}/media/program/$mid/location/$locationId|

!4 Check location (bron) is removed from clip in backend

|script                                                                  |
|get from|${urlBackendApi}/media/program/$mid/locations?owner=BROADCASTER|
|check   |xPath    |count(/collection/update:location)   |$sourceCount   |

!include -c <E2E.GuiSetUp

!4 Check location (bron) is removed from clip in gui

|script                                                                              |
|Open Npo poms website                                                               |
|Npo poms Inlogscherm Log in met ${gebruiker}                                        |
|Npo poms Zoeken Vul                         |$mid              |in zoekveld         |
|Npo poms Zoeken Druk knop                   |Zoeken                                 |
|Npo poms Zoeken Wacht tot zoeken klaar is                                           |
|ensure                                      |is visible on page|Gezocht naar: '$mid'|
|Npo poms Zoeken Check aantal zoekresultaten |1                                      |
|Npo poms Zoeken Open eerste object                                                  |
|Npo poms Tabblad object Druk op link        |Bronnen           |in sidebar          |
|Npo poms Tabblad object Wacht tot scrollen klaar is                                 |
|Npo poms Tabblad object Check aantal in veld|Bronnen           |is        |0        |

!include -c <E2E.GuiTearDown
