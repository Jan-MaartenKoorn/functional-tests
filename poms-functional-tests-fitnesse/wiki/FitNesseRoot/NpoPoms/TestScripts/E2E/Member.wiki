---
Help: Aanmaken, volgorde veranderen en verwijderen van onderdelen (members) in de backend zijn zichtbaar in de gui.
Suites: NPOAPI-156, RG
Test
---
!*> Test-specific items
!define gebruiker {standaard-gebruiker}

!define titel1 {Speciaal Clip 1 - $now}
!define subtitel1 {Sub title 1}

!define bodyCreateExtraClip1 { {{{
<program avType="AUDIO" embeddable="true" type="CLIP" xmlns="urn:vpro:media:update:2009">
  <broadcaster>NPO</broadcaster>
  <title type="MAIN">${titel1}</title>
  <title type="SUB">${subtitel1}</title>
  <genre>3.0.1.7.21</genre>
  <credits/>
  <locations/>
  <scheduleEvents/>
  <images/>
  <segments/>
</program>
}}} }

!define titel2 {Speciaal Clip 2 - $now}
!define subtitel2 {Sub title 2}

!define bodyCreateExtraClip2AndSetAsMember { {{{
<program avType="AUDIO" embeddable="true" type="CLIP" xmlns="urn:vpro:media:update:2009">
  <broadcaster>NPO</broadcaster>
  <title type="MAIN">${titel2}</title>
  <title type="SUB">${subtitel2}</title>
  <genre>3.0.1.7.21</genre>
  <credits/>
  <memberOf highlighted="true" position="2">$midOwner</memberOf>
  <locations/>
  <scheduleEvents/>
  <images/>
  <segments/>
</program>
}}} }

!define bodySetExtraClipAsMember { {{{
<?xml version="1.0"?>
<memberRef xmlns="urn:vpro:media:update:2009" position="1" highlighted="true">$midOwner</memberRef>
}}} }

!define bodyMoveMember { {{{
<?xml version="1.0"?>
<move xmlns="urn:vpro:media:update:2009">
  <from>0</from>
  <to>1</to>
</move>
}}} }
*!

!include -c <E2E.ApiBackendSetUp

!4 Save current number of members (onderdelen)

|script                                                                          |
|$midOwner=   |get var              |midClip                                     |
|$now=        |get var              |now                                         |
|get from     |${urlBackendApi}/media/program/$midOwner/members?owner=BROADCASTER|
|$memberCount=|xPath                |count(/update:list/update:item)             |

!4 Create extra clip 1 in backend

|script                                                                                       |
|show        |post|${bodyCreateExtraClip1}|to|${urlBackendApi}/media/program?owner=BROADCASTER|
|$midMember1=|response                                                                        |

!4 Wait until member 1 (onderdeel 1) visible in backend

|script                                                                                                       |
|show                           |get from        |${urlBackendApi}/media/program/$midMember1?owner=BROADCASTER|
|repeat until response status is|200                                                                          |
|$repeatCount=                  |repeat count                                                                 |
|$timeSpentRepeating=           |time spent repeating                                                         |
|$timeSpentRepeating=           |format timestamp|$timeSpentRepeating           |as           |m:ss           |

!4 Update clip 1 in backend: Set as member (onderdeel)

|script                                                                                                  |
|show |post           |${bodySetExtraClipAsMember}|to|${urlBackendApi}/media/program/$midMember1/memberOf|
|check|response status|202                                                                               |

!4 Check extra clip 1 added as member (onderdeel) in backend

|script                                                                        |
|get from|${urlBackendApi}/media/program/$midOwner/members?owner=BROADCASTER   |
|check   |xPath|/update:list/update:item[1]/update:mediaUpdate/@mid|$midMember1|

!4 Create extra clip 2 and set as member (onderdeel) in backend

|script                                                                                                     |
|show        |post|${bodyCreateExtraClip2AndSetAsMember}|to|${urlBackendApi}/media/program?owner=BROADCASTER|
|$midMember2=|response                                                                                      |

!4 Wait until there are 2 members (onderdelen)

|script                                                                                                               |
|show                |get from                       |${urlBackendApi}/media/media/$midOwner/members?owner=BROADCASTER|
|repeat until xPath  |count(/update:list/update:item)|is                              |2                              |
|$repeatCount=       |repeat count                                                                                    |
|$timeSpentRepeating=|time spent repeating                                                                            |
|$timeSpentRepeating=|format timestamp               |$timeSpentRepeating             |as            |m:ss            |

!include -c <E2E.GuiSetUp

!4 Check members (onderdelen) visible in gui

|script                                                                                                                                                    |
|Open Npo poms website                                                                                                                                     |
|Npo poms Inlogscherm Log in met ${gebruiker}                                                                                                              |
|Npo poms Zoeken Vul                           |$midOwner         |in zoekveld                                                                             |
|Npo poms Zoeken Druk knop                     |Zoeken                                                                                                     |
|Npo poms Zoeken Wacht tot zoeken klaar is                                                                                                                 |
|ensure                                        |is visible on page|Gezocht naar: '$midOwner'                                                               |
|Npo poms Zoeken Check aantal zoekresultaten   |1                                                                                                          |
|Npo poms Zoeken Open eerste object                                                                                                                        |
|set search context to                         |css=[id=sidebar]                                                                                           |
|ensure                                        |is visible on page|Onderdelen (2)                                                                          |
|clear search context                                                                                                                                      |
|Npo poms Tabblad object Check onderdeel nummer|1                 |heeft titel|${titel1}|en subtitel|${subtitel1}|en status|Voor publicatie|of|Gepubliceerd|
|Npo poms Tabblad object Check onderdeel nummer|2                 |heeft titel|${titel2}|en subtitel|${subtitel2}|en status|Voor publicatie|of|Gepubliceerd|

!include -c <E2E.GuiTearDown
!include -c <E2E.ApiBackendSetUp

!4 Switch member 1 and 2 (onderdeel 1+2) in backend

|script                                                                      |
|show|put|${bodyMoveMember}|to|${urlBackendApi}/media/group/$midOwner/members|

!4 Check member 1 and 2 (onderdeel 1+2) have switched places in backend

|script                                                                        |
|get from|${urlBackendApi}/media/program/$midOwner/members?owner=BROADCASTER   |
|check   |xPath|count(/update:list/update:item)                    |2          |
|check   |xPath|/update:list/update:item[1]/update:mediaUpdate/@mid|$midMember2|
|check   |xPath|/update:list/update:item[2]/update:mediaUpdate/@mid|$midMember1|

!include -c <E2E.GuiSetUp

!4 Check member 1 and 2 (onderdeel 1+2) have switched places in gui

|script                                                                                                                                                    |
|Open Npo poms website                                                                                                                                     |
|Npo poms Inlogscherm Log in met ${gebruiker}                                                                                                              |
|Npo poms Zoeken Vul                           |$midOwner         |in zoekveld                                                                             |
|Npo poms Zoeken Druk knop                     |Zoeken                                                                                                     |
|Npo poms Zoeken Wacht tot zoeken klaar is                                                                                                                 |
|ensure                                        |is visible on page|Gezocht naar: '$midOwner'                                                               |
|Npo poms Zoeken Check aantal zoekresultaten   |1                                                                                                          |
|Npo poms Zoeken Open eerste object                                                                                                                        |
|set search context to                         |css=[id=sidebar]                                                                                           |
|ensure                                        |is visible on page|Onderdelen (2)                                                                          |
|clear search context                                                                                                                                      |
|Npo poms Tabblad object Check onderdeel nummer|1                 |heeft titel|${titel2}|en subtitel|${subtitel2}|en status|Voor publicatie|of|Gepubliceerd|
|Npo poms Tabblad object Check onderdeel nummer|2                 |heeft titel|${titel1}|en subtitel|${subtitel1}|en status|Voor publicatie|of|Gepubliceerd|

!include -c <E2E.GuiTearDown
!include -c <E2E.ApiBackendSetUp

!4 Remove members (onderdelen) from clip in backend

|script                                                                 |
|show|delete|${urlBackendApi}/media/group/$midMember1/memberOf/$midOwner|
|show|delete|${urlBackendApi}/media/group/$midMember2/memberOf/$midOwner|

!4 Check members (onderdelen) are removed from clip in backend

|script                                                                     |
|get from|${urlBackendApi}/media/program/$midOwner/members?owner=BROADCASTER|
|check   |xPath      |count(/update:list/update:item)     |$memberCount     |

!4 Delete members (onderdelen) in backend

|script                                                |
|show|delete|${urlBackendApi}/media/program/$midMember1|
|show|delete|${urlBackendApi}/media/program/$midMember2|

!include -c <E2E.GuiSetUp

!4 Check members (onderdelen) deleted in gui

|script                                                                                  |
|Open Npo poms website                                                                   |
|Npo poms Inlogscherm Log in met ${gebruiker}                                            |
|Npo poms Zoeken Vul                        |$midOwner         |in zoekveld              |
|Npo poms Zoeken Druk knop                  |Zoeken                                      |
|Npo poms Zoeken Wacht tot zoeken klaar is                                               |
|ensure                                     |is visible on page|Gezocht naar: '$midOwner'|
|Npo poms Zoeken Check aantal zoekresultaten|1                                           |
|Npo poms Zoeken Open eerste object                                                      |
|set search context to                      |css=[id=sidebar]                            |
|ensure                                     |is visible on page|Onderdelen (0)           |
|clear search context                                                                    |

!include -c <E2E.GuiTearDown
