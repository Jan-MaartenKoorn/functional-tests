---
Help: Een aflevering (program) kan verwijderd worden van een seizoen met DELETE /media/program/{id}/episodeOf/{owner}.
Suites: NPOAPI-123, RG
Test
---
!*> Test-specific items
!define bodyCreateProgram { {{{
<program avType="VIDEO" embeddable="true" type="CLIP" xmlns="urn:vpro:media:update:2009">
  <broadcaster>NPO</broadcaster>
  <title type="MAIN">Speciaal Clip $timestamp</title>
  <credits/>
  <locations/>
  <scheduleEvents/>
  <images/>
  <segments/>
</program>
}}} }

!define bodyCreateSeason { {{{
<group avType="VIDEO" embeddable="true" type="SEASON" xmlns="urn:vpro:media:update:2009">
  <broadcaster>NPO</broadcaster>
  <title type="MAIN">Speciaal Seizoen $timestamp</title>
  <description type="MAIN">Seizoen Specialisterren.</description>
  <credits/>
  <locations/>
  <scheduleEvents/>
  <images/>
</group>
}}} }

!define bodyUpdateProgram { {{{
<program avType="VIDEO" embeddable="true" type="BROADCAST" urn="$urn" mid="$midProgram" xmlns="urn:vpro:media:update:2009">
  <broadcaster>NPO</broadcaster>
  <title type="MAIN">Speciaal uitzending $timestamp</title>
  <credits/>
  <locations/>
  <scheduleEvents/>
  <images/>
  <episodeOf highlighted="true" position="1">$midSeason</episodeOf>
  <segments/>
</program>
}}} }
*!

|script                                    |
|$timestamp=|value of|!today (yyyyMMddHHmm)|

!4 Create program with media type 'clip'

|script                                                                                                                   |
|show                           |post            |${bodyCreateProgram}|to|${urlBackendApi}/media/program?owner=BROADCASTER|
|$midProgram=                   |response                                                                                 |
|show                           |get from        |${urlBackendApi}/media/program/$midProgram/full                         |
|repeat until response status is|200                                                                                      |
|$repeatCount=                  |repeat count                                                                             |
|$timeSpentRepeating=           |time spent repeating                                                                     |
|$timeSpentRepeating=           |format timestamp|$timeSpentRepeating |as|m:ss                                            |
|$urn=                          |xPath           |/media:program/@urn                                                     |

!4 Create season

|script                                                                                                                |
|show                           |post            |${bodyCreateSeason}|to|${urlBackendApi}/media/group?owner=BROADCASTER|
|$midSeason=                    |response                                                                              |
|show                           |get from        |${urlBackendApi}/media/group/$midSeason/full                         |
|repeat until response status is|200                                                                                   |
|$repeatCount=                  |repeat count                                                                          |
|$timeSpentRepeating=           |time spent repeating                                                                  |
|$timeSpentRepeating=           |format timestamp|$timeSpentRepeating|as|m:ss                                          |

!4 Update program: Change media type to 'broadcast' and set program as episode of season

|script                                                                                                                       |
|show                |post                           |${bodyUpdateProgram}|to|${urlBackendApi}/media/program?owner=BROADCASTER|
|get from            |${urlBackendApi}/media/group/$midSeason/episodes?owner=BROADCASTER                                      |
|repeat until xPath  |count(/update:list/update:item)|is                  |1                                                  |
|$repeatCount=       |repeat count                                                                                            |
|$timeSpentRepeating=|time spent repeating                                                                                    |
|$timeSpentRepeating=|format timestamp               |$timeSpentRepeating |as|m:ss                                            |

!4 Check program is only episode of season

|script                                                                     |
|get from|${urlBackendApi}/media/group/$midSeason/episodes?owner=BROADCASTER|
|check   |xPath|count(/update:list/update:item)                 |1          |
|check   |xPath|/update:list/update:item/update:mediaUpdate/@mid|$midProgram|

!4 Delete episode from season with DELETE /media/program/{id}/episodeOf/{owner}

|script                                                                               |
|show |delete         |${urlBackendApi}/media/program/$midProgram/episodeOf/$midSeason|
|check|response status|202                                                            |

!4 Check season has no episodes anymore 

|script                                                                     |
|get from|${urlBackendApi}/media/group/$midSeason/episodes?owner=BROADCASTER|
|check   |xPath         |count(/update:list/update:item)         |0         |

!4 Delete program and season

|script                                                |
|show|delete|${urlBackendApi}/media/program/$midProgram|
|show|delete|${urlBackendApi}/media/program/$midSeason |
