---
Help: Een aflevering (program) kan toegevoegd worden aan een seizoen met POST /media/program/{id}/episodeOf.
Suites: NPOAPI-122, RG
Test
---
!*> Test-specific items
!define bodyCreateSeason { {{{
<group avType="VIDEO" embeddable="true" type="SEASON" xmlns="urn:vpro:media:update:2009">
  <broadcaster>NPO</broadcaster>
  <title type="MAIN">Speciaal Seizoen $timestamp</title>
  <description type="MAIN">Seizoen Specialisterren.</description>
  <credits/>
  <locations/>
  <scheduleEvents/>
  <images/>
</group>
}}} }
!define bodyCreateProgram { {{{
<program xmlns="urn:vpro:media:update:2009" type="CLIP" avType="VIDEO" embeddable="true">
  <broadcaster>NPO</broadcaster>
  <title type="MAIN">Specialisterren $timestamp</title>
  <title type="SUB">Testsubtitle</title>
  <title type="ORIGINAL">Original title</title>
  <description type="MAIN">Deze clip is aangemaakt door Specialisterren.</description>
  <description type="SHORT">Specialisterren Clip.</description>
  <description type="SUB">Specialisterren Clip.</description>
  <description type="EPISODE">Nieuwe Clip van vandaag.</description>
  <credits/>
  <locations/>
  <scheduleEvents/>
  <images/>
  <segments/>
</program>
}}} }
!define bodyUpdateProgram { {{{
<program xmlns="urn:vpro:media:update:2009" type="BROADCAST" urn="$urnProgram" mid="$midProgram" avType="VIDEO" embeddable="true">
  <broadcaster>NPO</broadcaster>
  <title type="MAIN">Speciaal Uitzending $timestamp</title>
  <description type="MAIN">Uitzending Specialisterren.</description>
  <credits/>
  <locations/>
  <scheduleEvents/>
  <images/>
  <segments/>
</program>
}}} }
!define bodyAddProgramToSeason { {{{
<?xml version="1.0"?>
<memberRef xmlns="urn:vpro:media:update:2009" position="1" highlighted="true">$midSeason</memberRef>
}}} }
*!
|script                                    |
|$timestamp=|value of|!today (yyyyMMddHHmm)|

!4 Create season

|script                                                                                                                |
|show                           |post            |${bodyCreateSeason}|to|${urlBackendApi}/media/group?owner=BROADCASTER|
|$midSeason=                    |response                                                                              |
|show                           |get from        |${urlBackendApi}/media/group/$midSeason/full                         |
|repeat until response status is|200                                                                                   |
|$repeatCount=                  |repeat count                                                                          |
|$timeSpentRepeating=           |time spent repeating                                                                  |
|$timeSpentRepeating=           |format timestamp|$timeSpentRepeating|as|m:ss                                          |

!4 Create program with media type 'clip'

|script                                                                                                                  |
|show                           |post           |${bodyCreateProgram}|to|${urlBackendApi}/media/program?owner=BROADCASTER|
|check                          |response status|202                                                                     |
|$midProgram=                   |response                                                                                |
|show                           |get from       |${urlBackendApi}/media/program/$midProgram?owner=BROADCASTER            |
|repeat until response status is|200                                                                                     |
|show                           |time spent repeating                                                                    |
|check                          |xPath          |/update:program/@mid|$midProgram                                        |
|$urnProgram=                   |xPath          |/update:program/@urn                                                    |

!4 Update program: Change media type to 'broadcast'

|script                                                                                                             |
|show                |post                 |${bodyUpdateProgram}|to|${urlBackendApi}/media/program?owner=BROADCASTER|
|show                |get from             |${urlBackendApi}/media/program/$midProgram?owner=BROADCASTER            |
|repeat until xPath  |/update:program/@type|is                  |BROADCAST                                          |
|$repeatCount=       |repeat count                                                                                  |
|$timeSpentRepeating=|time spent repeating                                                                          |
|$timeSpentRepeating=|format timestamp     |$timeSpentRepeating |as|m:ss                                            |

!4 Set program as episode of season with POST /media/program/{id}/episodeOf

|script                                                                                                                                |
|show                |post                           |${bodyAddProgramToSeason}|to|${urlBackendApi}/media/program/$midProgram/episodeOf|
|get from            |${urlBackendApi}/media/group/$midSeason/episodes?owner=BROADCASTER                                               |
|repeat until xPath  |count(/update:list/update:item)|is                       |1                                                      |
|$repeatCount=       |repeat count                                                                                                     |
|$timeSpentRepeating=|time spent repeating                                                                                             |
|$timeSpentRepeating=|format timestamp               |$timeSpentRepeating      |as|m:ss                                                |

!4 Check program is episode of season

|script                                                                     |
|get from|${urlBackendApi}/media/group/$midSeason/episodes?owner=BROADCASTER|
|check   |xPath|/update:list/update:item/update:mediaUpdate/@mid|$midProgram|
