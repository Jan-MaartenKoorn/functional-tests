---
Help: Een bron kan toegevoegd worden aan een object met POST /media/{entity}/{id}/location en een bron kan verwijderd worden van een object met DELETE /media/{entity}/{id}/location/{locationId}.
Suites: NPOAPI-101, NPOAPI-103, RG
Test
---
!*> Test-specific items
!define programUrl {!-http://radiobox2.omroep.nl/audiofragment/file/106470/fragment.mp3-!}
!define avFileFormat {MP3}
!define duration {P0DT0H10M2.000S}
!define body { {{{
<?xml version="1.0"?>
<location xmlns="urn:vpro:media:update:2009">
  <programUrl>${programUrl}</programUrl>
    <avAttributes>
      <avFileFormat>${avFileFormat}</avFileFormat>
    </avAttributes>
  <duration>${duration}</duration>
</location>
}}} }
*!

!4 Save current number of sources

|script                                                                     |
|$mid=        |get var          |midClip                                    |
|get from     |${urlBackendApi}/media/media/$mid/locations?owner=BROADCASTER|
|$sourceCount=|xPath            |count(/collection/update:location)         |

!4 Add source to clip with POST /media/{entity}/{id}/location

|script                                                                     |
|show |post           |${body}|to|${urlBackendApi}/media/media/$mid/location|
|check|response status|202                                                  |
|check|response       |Location accepted for $mid.                          |

!4 Check source is added to clip

|script                                                                                                                                                    |
|get from    |${urlBackendApi}/media/media/$mid/locations?owner=BROADCASTER                                                                                |
|check       |xPath         |/collection/update:location[last()]/update:programUrl                      |${programUrl}                                     |
|check       |xPath         |/collection/update:location[last()]/update:avAttributes/update:avFileFormat|${avFileFormat}                                   |
|check       |xPath         |/collection/update:location[last()]/update:duration                        |${duration}                                       |
|$urn=       |xPath         |/collection/update:location/@urn                                                                                              |
|$locationId=|extract string|$urn                                                                       |from|^urn:vpro:media:location:(\d+)$|using group|1|

!4 Remove source from clip with DELETE /media/{entity}/{id}/location/{locationId}

|script                                                                      |
|show |delete         |${urlBackendApi}/media/media/$mid/location/$locationId|
|check|response status|202                                                   |
|check|response       |Location delete submitted to $mid.                    |

!4 Check source is removed from clip

|script                                                                |
|get from|${urlBackendApi}/media/media/$mid/locations?owner=BROADCASTER|
|check   |xPath   |count(/collection/update:location)   |$sourceCount  |
